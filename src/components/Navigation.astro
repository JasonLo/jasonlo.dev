---
import { siteConfig } from '../config';
import SearchButton from './SearchButton.astro';
import ThemeToggle from './ThemeToggle.astro';

const currentPath = Astro.url.pathname;

const navItems = siteConfig.nav;

const isActive = (href: string) => {
  if (href === '/') {
    return currentPath === '/';
  }
  return currentPath.startsWith(href);
};
---

<nav class="site-nav" aria-label="Main navigation">
  <a href="/" class="nav-brand" aria-label="Home">
    <svg viewBox="0 0 406 96" fill="currentColor" height="1.75rem" aria-hidden="true">
      <path d="M69.50 8.10Q69.50 11.10 68.25 12.60Q67.00 14.10 64.20 14.10L64.20 14.10Q64.00 16.20 63.30 21.40L63.30 21.40Q62.30 28.40 62.20 29.20L62.20 29.20Q53.30 95.50 25.10 95.50L25.10 95.50Q16.80 95.50 12.15 90.80Q7.50 86.10 7.50 79.00L7.50 79.00Q7.50 66.30 18.30 56.55Q29.10 46.80 46.70 40.40L46.70 40.40Q47.80 33.30 48.40 27.70L48.40 27.70L50.20 12.60Q44.20 12.00 39 12.00L39 12.00Q25.10 12.00 18.50 14.70Q11.90 17.40 11.90 23.50L11.90 23.50Q11.90 26.50 13.90 30.00L13.90 30.00Q14.50 31.00 14.50 32.10L14.50 32.10Q14.50 34.20 12.35 35.85Q10.20 37.50 7.70 37.50L7.70 37.50Q4.50 37.50 2.80 34.80L2.80 34.80Q0 30.20 0 24.10L0 24.10Q0 0.10 42 0.10L42 0.10Q54.20 0.10 63.80 2.50L63.80 2.50Q69.50 3.90 69.50 8.10L69.50 8.10ZM26.40 84.80Q31.30 84.80 36.20 77.40Q41.10 70.00 44.80 51.50L44.80 51.50Q20.40 62.20 20.40 77.70L20.40 77.70Q20.40 81.10 22 82.95Q23.60 84.80 26.40 84.80L26.40 84.80ZM77.80 85.30Q71.60 85.30 67.90 80.80Q64.20 76.30 64.20 69.00L64.20 69.00Q64.20 61.00 67.90 53.85Q71.60 46.70 77.75 42.35Q83.90 38.00 90.80 38.00L90.80 38.00Q93 38.00 93.75 38.85Q94.50 39.70 95 41.90L95 41.90Q97.10 41.50 99.40 41.50L99.40 41.50Q104.30 41.50 104.30 45.00L104.30 45.00Q104.30 47.10 102.80 55.00L102.80 55.00Q100.50 66.50 100.50 71.00L100.50 71.00Q100.50 72.50 101.25 73.40Q102 74.30 103.20 74.30L103.20 74.30Q105.10 74.30 107.80 71.85Q110.50 69.40 115.10 63.90L115.10 63.90Q116.30 62.50 117.80 62.50L117.80 62.50Q119.10 62.50 119.85 63.70Q120.60 64.90 120.60 67.00L120.60 67.00Q120.60 71.00 118.70 73.20L118.70 73.20Q114.60 78.30 110 81.80Q105.40 85.30 101.10 85.30L101.10 85.30Q97.80 85.30 95.05 83.05Q92.30 80.80 90.90 76.90L90.90 76.90Q85.70 85.30 77.80 85.30L77.80 85.30ZM81.40 75.20Q83.60 75.20 85.60 72.60Q87.60 70.00 88.50 65.70L88.50 65.70L92.20 47.30Q88 47.40 84.45 50.45Q80.90 53.50 78.80 58.50Q76.70 63.50 76.70 69.10L76.70 69.10Q76.70 72.20 77.95 73.70Q79.20 75.20 81.40 75.20L81.40 75.20ZM131.10 87.50Q125.90 87.50 123.15 85.10Q120.40 82.70 120.40 79.70L120.40 79.70Q120.40 77.10 122.30 75.20Q124.20 73.30 127.90 73.30L127.90 73.30Q129.20 73.30 130.95 73.55Q132.70 73.80 133.60 73.90L133.60 73.90Q133.50 71.30 132.45 69.00Q131.40 66.70 129.80 64.55Q128.20 62.40 126.80 60.80L126.80 60.80Q123.70 66.70 120.65 70.60Q117.60 74.50 114 78.00L114 78.00Q112.20 79.80 110.20 79.80L110.20 79.80Q108.60 79.80 107.60 78.65Q106.60 77.50 106.60 75.80L106.60 75.80Q106.60 73.80 108 72.10L108 72.10L109.30 70.50Q114.80 63.70 117.60 59.30L117.60 59.30Q119.30 56.40 121.60 51.55Q123.90 46.70 126.10 41.50L126.10 41.50Q128 37.10 134 37.10L134 37.10Q136.80 37.10 137.90 37.60Q139 38.10 139 39.20L139 39.20Q139 39.80 138.60 41.10Q138.20 42.40 137.50 43.70L137.50 43.70Q135.70 47.30 135.70 49.80L135.70 49.80Q135.70 51.30 136.75 53.10Q137.80 54.90 140 57.60L140 57.60Q143.20 61.80 144.85 64.75Q146.50 67.70 146.50 71.20L146.50 71.20Q146.50 72.20 146.30 74.00L146.30 74.00Q151.20 72.10 157.80 63.90L157.80 63.90Q159 62.50 160.50 62.50L160.50 62.50Q161.80 62.50 162.55 63.70Q163.30 64.90 163.30 67.00L163.30 67.00Q163.30 70.80 161.40 73.20L161.40 73.20Q156.40 79.40 151.85 81.65Q147.30 83.90 140.60 84.10L140.60 84.10Q136.60 87.50 131.10 87.50L131.10 87.50ZM206.20 54.10Q207.50 54.10 208.20 55.40Q208.90 56.70 208.90 58.70L208.90 58.70Q208.90 63.50 206 64.40L206 64.40Q200 66.50 192.80 66.80L192.80 66.80Q190.90 75.20 185.30 80.25Q179.70 85.30 172.60 85.30L172.60 85.30Q166.60 85.30 162.35 82.40Q158.10 79.50 155.90 74.70Q153.70 69.90 153.70 64.30L153.70 64.30Q153.70 56.70 156.60 50.75Q159.50 44.80 164.60 41.45Q169.70 38.10 175.90 38.10L175.90 38.10Q183.50 38.10 188.15 43.35Q192.80 48.60 193.60 56.30L193.60 56.30Q198.30 56.00 204.80 54.30L204.80 54.30Q205.60 54.10 206.20 54.10L206.20 54.10ZM173.40 74.70Q176.60 74.70 178.95 72.10Q181.30 69.50 182.10 64.60L182.10 64.60Q179 62.50 177.35 59.10Q175.70 55.70 175.70 51.90L175.70 51.90Q175.70 50.30 176 48.70L176 48.70L175.50 48.70Q171.50 48.70 168.85 52.55Q166.20 56.40 166.20 63.40L166.20 63.40Q166.20 68.90 168.35 71.80Q170.50 74.70 173.40 74.70L173.40 74.70ZM207.40 85.30Q203.60 85.30 202.05 81.30Q200.50 77.30 200.50 68.50L200.50 68.50Q200.50 55.50 204.20 43.80L204.20 43.80Q205.10 40.90 207.15 39.55Q209.20 38.20 212.90 38.20L212.90 38.20Q214.90 38.20 215.70 38.70Q216.50 39.20 216.50 40.60L216.50 40.60Q216.50 42.20 215 47.80L215 47.80Q214 51.80 213.40 54.80Q212.80 57.80 212.40 62.20L212.40 62.20Q215.70 53.60 219.80 48.20Q223.90 42.80 227.85 40.50Q231.80 38.20 235.10 38.20L235.10 38.20Q241.60 38.20 241.60 44.70L241.60 44.70Q241.60 48.60 239.40 58.80L239.40 58.80Q237.50 67.50 237.50 70.30L237.50 70.30Q237.50 74.30 240.40 74.30L240.40 74.30Q242.40 74.30 245.15 71.85Q247.90 69.40 252.50 63.90L252.50 63.90Q253.70 62.50 255.20 62.50L255.20 62.50Q256.50 62.50 257.25 63.70Q258 64.90 258 67.00L258 67.00Q258 71.00 256.10 73.20L256.10 73.20Q251.80 78.50 246.85 81.90Q241.90 85.30 235.60 85.30L235.60 85.30Q230.50 85.30 227.90 82.35Q225.30 79.40 225.30 73.80L225.30 73.80Q225.30 71.00 226.70 63.80L226.70 63.80Q228 57.50 228 55.10L228 55.10Q228 53.50 226.90 53.50L226.90 53.50Q225.60 53.50 223.25 56.85Q220.90 60.20 218.45 65.70Q216 71.20 214.50 77.30L214.50 77.30Q213.40 82.00 211.95 83.65Q210.50 85.30 207.40 85.30L207.40 85.30ZM349 62.50Q350.30 62.50 351.05 63.70Q351.80 64.90 351.80 67.00L351.80 67.00Q351.80 70.90 349.90 73.20L349.90 73.20Q344.30 79.90 339.05 82.60Q333.80 85.30 326.40 85.30L326.40 85.30Q321.20 85.30 316.80 84.00Q312.40 82.70 306.10 80.10L306.10 80.10Q300.40 77.60 295.10 76.00L295.10 76.00Q290 85.30 279.80 85.30L279.80 85.30Q274.20 85.30 270.85 82.75Q267.50 80.20 267.50 76.20L267.50 76.20Q267.50 71.30 272.20 68.05Q276.90 64.80 284.70 64.80L284.70 64.80L286 64.80L287.80 35.70Q288.40 25.70 291.40 19.20Q294.40 12.70 299.70 8.10L299.70 8.10Q304.30 4.10 310.20 2.05Q316.10 0 322.70 0L322.70 0Q333.50 0 339.30 5.60Q345.10 11.20 345.10 20.20L345.10 20.20Q345.10 26.30 342.90 30.05Q340.70 33.80 336.80 33.80L336.80 33.80Q334 33.80 332.40 32.45Q330.80 31.10 330.80 28.60L330.80 28.60Q330.80 27.70 331.20 25.30L331.20 25.30Q331.80 22.50 331.80 20.30L331.80 20.30Q331.80 16.10 329.35 13.65Q326.90 11.20 321.90 11.20L321.90 11.20Q313.10 11.20 308.30 16.95Q303.50 22.70 302.20 35.00L302.20 35.00L299.90 57.70Q299.40 62.50 298.60 66.00L298.60 66.00Q305 67.10 314.60 69.50L314.60 69.50Q320.20 70.90 323.20 71.50Q326.20 72.10 328.50 72.10L328.50 72.10Q334.30 72.10 338.45 70.15Q342.60 68.20 346.30 63.90L346.30 63.90Q347.50 62.50 349 62.50L349 62.50ZM402.70 54.10Q404.00 54.10 404.70 55.40Q405.40 56.70 405.40 58.70L405.40 58.70Q405.40 63.50 402.50 64.40L402.50 64.40Q396.50 66.50 389.30 66.80L389.30 66.80Q387.40 75.20 381.80 80.25Q376.20 85.30 369.10 85.30L369.10 85.30Q363.10 85.30 358.85 82.40Q354.60 79.50 352.40 74.70Q350.20 69.90 350.20 64.30L350.20 64.30Q350.20 56.70 353.10 50.75Q356.00 44.80 361.10 41.45Q366.20 38.10 372.40 38.10L372.40 38.10Q380.00 38.10 384.65 43.35Q389.30 48.60 390.10 56.30L390.10 56.30Q394.80 56.00 401.30 54.30L401.30 54.30Q402.10 54.10 402.70 54.10L402.70 54.10ZM369.90 74.70Q373.10 74.70 375.45 72.10Q377.80 69.50 378.60 64.60L378.60 64.60Q375.50 62.50 373.85 59.10Q372.20 55.70 372.20 51.90L372.20 51.90Q372.20 50.30 372.50 48.70L372.50 48.70L372.00 48.70Q368.00 48.70 365.35 52.55Q362.70 56.40 362.70 63.40L362.70 63.40Q362.70 68.90 364.85 71.80Q367.00 74.70 369.90 74.70L369.90 74.70Z" />
    </svg>
  </a>
  <div class="nav-scroll">
    <ul class="nav-list">
      {navItems.map((item) => (
        <li class="nav-item">
          <a 
            href={item.href} 
            class:list={['nav-link', { 'nav-link--active': isActive(item.href) }]}
            aria-current={isActive(item.href) ? 'page' : undefined}
          >
            {item.label}
          </a>
        </li>
      ))}
    </ul>
  </div>
  <div class="nav-end">
    <SearchButton />
    <ThemeToggle />
  </div>
</nav>

<script>
  function updateActiveNav() {
    const currentPath = window.location.pathname;
    const navLinks = document.querySelectorAll('.nav-link');
    
    navLinks.forEach((link) => {
      const href = link.getAttribute('href');
      let isActive = false;
      
      if (href === '/') {
        isActive = currentPath === '/';
      } else if (href) {
        isActive = currentPath.startsWith(href);
      }
      
      link.classList.toggle('nav-link--active', isActive);
      if (isActive) {
        link.setAttribute('aria-current', 'page');
      } else {
        link.removeAttribute('aria-current');
      }
    });
  }

  // Run on initial load and after each navigation
  document.addEventListener('astro:page-load', updateActiveNav);
</script>

<style>
  .site-nav {
    display: flex;
    align-items: center;
    border-bottom: 1px solid var(--color-border);
    background: var(--color-bg);
    padding: var(--space-md) 0;
  }

  .nav-brand {
    flex-shrink: 0;
    display: inline-flex;
    align-items: center;
    text-decoration: none;
    padding-left: 1.5rem;
    color: var(--color-text);
    transition: transform 0.3s ease;
  }

  .nav-brand:hover {
    transform: scale(1.05);
  }
  
  .nav-brand:focus-visible {
    outline: 2px solid var(--color-accent);
    outline-offset: 4px;
    border-radius: var(--border-radius-sm);
  }

  .nav-scroll {
    flex: 1;
    overflow-x: auto;
    overflow-y: hidden;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    -ms-overflow-style: none;
  }

  .nav-scroll::-webkit-scrollbar {
    display: none;
  }

  .nav-list {
    display: flex;
    flex-wrap: nowrap;
    justify-content: flex-end;
    gap: 2rem;
    list-style: none;
    margin: 0;
    padding: 0.5rem 1.5rem;
    min-width: max-content;
  }

  .nav-item {
    margin: 0;
    flex-shrink: 0;
  }

  .nav-link {
    color: var(--color-text-secondary);
    font-size: 0.8125rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    text-decoration: none;
    transition: color 0.2s ease;
    white-space: nowrap;
  }

  .nav-link:hover {
    color: var(--color-text);
  }

  .nav-link--active {
    color: var(--color-text);
  }

  .nav-end {
    flex-shrink: 0;
    display: flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0 0.75rem;
    border-left: 1px solid var(--color-border);
    background: var(--color-bg);
    position: relative;
  }

  .nav-end::before {
    content: '';
    position: absolute;
    left: -24px;
    top: 0;
    bottom: 0;
    width: 24px;
    background: linear-gradient(to right, transparent, var(--color-bg));
    pointer-events: none;
  }

  @media (max-width: 768px) {
    .nav-brand {
      padding-left: 1rem;
    }

    .nav-list {
      justify-content: flex-start;
      gap: 1.5rem;
      padding: 0.5rem 1rem;
    }

    .nav-link {
      font-size: 0.75rem;
    }

    .nav-end {
      padding: 0 0.5rem;
    }

    .nav-end::before {
      left: -16px;
      width: 16px;
    }
  }
</style>
