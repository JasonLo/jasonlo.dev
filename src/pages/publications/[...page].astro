---
import ListLayout from '../../components/ListLayout.astro';
import ArrowLink from '../../components/ArrowLink.astro';
import { getCollection } from 'astro:content';
import { pagesConfig } from '../../pages.config';
import type { GetStaticPaths } from 'astro';

export const getStaticPaths: GetStaticPaths = async () => {
  return [{ params: { page: undefined } }];
};

const allArticles = await getCollection('publications', ({ data }) => {
  return data.draft === false;
});

// Default sort: most recent first
const sortedArticles = [...allArticles].sort(
  (a, b) => b.data.publishDate.getTime() - a.data.publishDate.getTime()
);
---

<ListLayout
  title={pagesConfig.publications.heading}
  intro={pagesConfig.publications.intro}
  description={pagesConfig.publications.description}
  itemCount={sortedArticles.length}
  itemLabel="publications"
  sortOptions={[
    { key: 'recent', label: 'Recent' },
    { key: 'citations', label: 'Citations' },
    { key: 'title', label: 'Title' }
  ]}
  defaultSort="recent"
  listId="publications-list"
  emptyMessage="No articles published yet."
>
  {sortedArticles.map((article) => {
    const year = article.data.publishDate.getFullYear();
    const RowTag = article.data.doi ? 'a' : 'div';
    return (
      <RowTag
        class="row-item"
        data-sort-recent={article.data.publishDate.getTime()}
        data-sort-citations={article.data.citedByCount}
        data-sort-title={article.data.title.toLowerCase()}
        {...(article.data.doi && { href: article.data.doi, target: '_blank', rel: 'noopener noreferrer' })}
      >
        <div class="row-year">{year}</div>
        <div class="row-body">
          <span class="row-title">{article.data.title}</span>
          <span class="row-desc">{article.data.authors.join(', ')}</span>
          <div class="row-meta">
            <span>{article.data.journal}</span>
            {article.data.citedByCount > 0 && (
              <span class="pub-citations">{article.data.citedByCount} citations</span>
            )}
          </div>
        </div>
        {article.data.doi && (
          <div class="row-arrow">
            <ArrowLink text="" icon="external" variant="muted" />
          </div>
        )}
      </RowTag>
    );
  })}
</ListLayout>

<style>
  .pub-citations {
    padding: 0.0625rem 0.4375rem;
    border-radius: 3px;
    background: var(--color-accent-muted);
    font-variant-numeric: tabular-nums;
  }
</style>
