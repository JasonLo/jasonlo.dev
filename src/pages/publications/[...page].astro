---
import ListLayout from '../../components/ListLayout.astro';
import { getCollection } from 'astro:content';
import { pagesConfig } from '../../pages.config';
import type { GetStaticPaths } from 'astro';

export const getStaticPaths: GetStaticPaths = async () => {
  return [{ params: { page: undefined } }];
};

const allArticles = await getCollection('publications', ({ data }) => {
  return data.draft === false;
});

// Default sort: most recent first
const sortedArticles = [...allArticles].sort(
  (a, b) => b.data.publishDate.getTime() - a.data.publishDate.getTime()
);
---

<ListLayout
  title={pagesConfig.publications.heading}
  intro={pagesConfig.publications.intro}
  description={pagesConfig.publications.description}
  itemCount={sortedArticles.length}
  itemLabel="publications"
  sortOptions={[
    { key: 'recent', label: 'Recent' },
    { key: 'citations', label: 'Citations' },
    { key: 'title', label: 'Title' }
  ]}
  defaultSort="recent"
  listId="publications-list"
  emptyMessage="No articles published yet."
>
  {sortedArticles.map((article) => {
    const year = article.data.publishDate.getFullYear();
    const href = article.data.doi || `/publications/${article.id}`;
    return (
      <a
        class="row-item"
        href={href}
        data-sort-recent={article.data.publishDate.getTime()}
        data-sort-citations={article.data.citedByCount}
        data-sort-title={article.data.title.toLowerCase()}
      >
        <div class="row-year">{year}</div>
        <div class="row-body">
          <span class="row-title">{article.data.title}</span>
          <span class="row-desc">{article.data.authors.join(', ')}</span>
          <div class="row-meta">
            <span>{article.data.journal}</span>
            {article.data.citedByCount > 0 && (
              <span class="pub-citations">{article.data.citedByCount} citations</span>
            )}
          </div>
        </div>
        <div class="row-arrow">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
            <polyline points="15 3 21 3 21 9"></polyline>
            <line x1="10" y1="14" x2="21" y2="3"></line>
          </svg>
        </div>
      </a>
    );
  })}
</ListLayout>

<style>
  .pub-citations {
    padding: 0.0625rem 0.4375rem;
    border-radius: 3px;
    background: var(--color-accent-muted);
    font-variant-numeric: tabular-nums;
  }
</style>
